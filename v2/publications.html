<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Paul Schmitt - Publications. Research in networking, privacy, and systems.">
    <meta name="keywords" content="Paul Schmitt, publications, research, networking, privacy">
    <meta name="author" content="Paul Schmitt">
    <title>Publications | Paul Schmitt</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">Paul Schmitt</a>
            <div class="spacer"></div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="publications.html">Bibliography</a></li>
                <li><a href="teaching.html">Teaching</a></li>
                <li><a href="../docs/cv.pdf">CV</a></li>
                <li><button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode"></button></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="publications">
            <h2>Bibliography</h2>
            <div id="publications-list"></div>
        </section>

        <section id="preprints">
            <h2>Preprints & Work in Submission</h2>
            <div id="preprints-list"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2026 Paul Schmitt. All rights reserved.</p>
    </footer>

    <div id="bibtex-modal" class="bibtex-modal">
        <div class="bibtex-modal-content">
            <div class="bibtex-modal-header">
                <h3>BibTeX</h3>
                <button class="bibtex-close" aria-label="Close">&times;</button>
            </div>
            <div id="bibtex-text" class="bibtex-text"></div>
            <button id="bibtex-copy-btn" class="bibtex-copy-btn">Copy to Clipboard</button>
        </div>
    </div>

    <script>
        // Theme management
        const THEME = {
            DARK: 'dark',
            LIGHT: 'light',
            STORAGE_KEY: 'theme',
            SUN_ICON: '<svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',
            MOON_ICON: '<svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'
        };

        const ThemeManager = {
            init() {
                const toggle = document.getElementById('theme-toggle');
                const savedTheme = localStorage.getItem(THEME.STORAGE_KEY);
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (prefersDark ? THEME.DARK : THEME.LIGHT);

                this.set(theme);
                toggle.addEventListener('click', () => this.toggle());
            },

            set(theme) {
                const html = document.documentElement;
                const toggle = document.getElementById('theme-toggle');
                const isDark = theme === THEME.DARK;

                html.classList.toggle('dark-mode', isDark);
                html.classList.toggle('light-mode', !isDark);
                toggle.innerHTML = isDark ? THEME.MOON_ICON : THEME.SUN_ICON;
                toggle.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
                localStorage.setItem(THEME.STORAGE_KEY, theme);
            },

            toggle() {
                const html = document.documentElement;
                const isDark = html.classList.contains('dark-mode');
                this.set(isDark ? THEME.LIGHT : THEME.DARK);
            }
        };

        // Publications
        const PublicationManager = {
            async load() {
                try {
                    const response = await fetch('data.json');
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    this.renderAll(data.publications, 'publications-list');
                    this.renderAll(data.preprints, 'preprints-list');
                } catch (error) {
                    console.error('Failed to load publications:', error);
                }
            },

            renderAll(publications, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                publications.forEach(pub => {
                    container.appendChild(this.createArticle(pub));
                });
            },

            createArticle(pub) {
                const article = document.createElement('article');
                article.className = 'publication';

                let links = '';
                if (pub.pdf) links += `<a href="${pub.pdf}" class="pub-link">PDF</a>`;
                if (pub.bibtex) links += `<button class="bibtex-btn" data-bibtex='${pub.bibtex}'>BibTeX</button>`;

                article.innerHTML = `
                    <h3>${pub.title}</h3>
                    <div class="authors">${pub.authors}</div>
                    <div class="venue">${pub.venue}${pub.date ? ', ' + pub.date : ''}</div>
                    ${links ? `<div class="pub-links">${links}</div>` : ''}
                `;

                const btn = article.querySelector('.bibtex-btn');
                if (btn) btn.addEventListener('click', (e) => BibtexModal.show(e.target));

                return article;
            }
        };

        const BibtexModal = {
            open() {
                return document.getElementById('bibtex-modal');
            },

            show(button) {
                const modal = this.open();
                const text = button.getAttribute('data-bibtex');
                document.getElementById('bibtex-text').textContent = text;
                modal.classList.add('active');
            },

            close() {
                this.open().classList.remove('active');
            },

            copy() {
                const text = document.getElementById('bibtex-text').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    const btn = document.getElementById('bibtex-copy-btn');
                    const original = btn.textContent;
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = original;
                        btn.classList.remove('copied');
                    }, 2000);
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            ThemeManager.init();
            PublicationManager.load();

            const modal = BibtexModal.open();
            document.getElementById('bibtex-copy-btn').addEventListener('click', () => BibtexModal.copy());
            document.querySelector('.bibtex-close').addEventListener('click', () => BibtexModal.close());

            modal.addEventListener('click', (e) => {
                if (e.target === modal) BibtexModal.close();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') BibtexModal.close();
            });
        });
    </script>
</body>
</html>
